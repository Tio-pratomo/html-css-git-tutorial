---
title: Integrasi Login Frontend dengan Backend Session
---

## Materi: Pengetahuan & Konsep

Sekarang backend punya autentikasi session (Sesi 27), tapi frontend masih pakai HTML statis.

Di sesi ini kita hubungkan `login.html` ke `/api/login`, lalu tampilkan username di navbar `dashboard.html`.

Poin penting saat fetch dengan session cookies:

- Browser otomatis simpan cookie session dari server saat login berhasil.
- Untuk fetch request berikutnya mengirim cookie tersebut, kamu harus set **`credentials: 'include'`** (jika frontend & backend beda origin) atau `credentials: 'same-origin'` (jika sama origin).
- Redirect setelah login pakai `window.location.href` atau `window.location.replace()`.

---

## Praktik: Langkah demi Langkah

### Langkah 1: Update `login.html` – form submit dengan fetch

Buka `login.html`, ganti action form atau tambahkan script untuk intercept submit:

```html
<form id="login-form">
  <div class="field">
    <label class="label">Username</label>
    <div class="control has-icons-left">
      <input
        id="username"
        class="input"
        type="text"
        placeholder="Username"
        required
      />
      <span class="icon is-small is-left">
        <i class="fas fa-user"></i>
      </span>
    </div>
  </div>

  <div class="field">
    <label class="label">Password</label>
    <div class="control has-icons-left">
      <input
        id="password"
        class="input"
        type="password"
        placeholder="Password"
        required
      />
      <span class="icon is-small is-left">
        <i class="fas fa-lock"></i>
      </span>
    </div>
  </div>

  <div class="field">
    <div class="control">
      <button type="submit" class="button is-primary is-fullwidth">
        Login
      </button>
    </div>
  </div>

  <!-- Alert box untuk error -->
  <div id="login-alert"></div>
</form>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("login-form");
    const alertBox = document.getElementById("login-alert");

    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!username || !password) {
        showAlert("Username dan password wajib diisi.", "is-danger");
        return;
      }

      try {
        const response = await fetch("http://localhost:3000/api/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include", // Penting: kirim & simpan cookie session
          body: JSON.stringify({ username, password }),
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || "Login gagal");
        }

        const data = await response.json();

        // Redirect ke dashboard setelah sukses
        window.location.href = "dashboard.html";
      } catch (err) {
        console.error(err);
        showAlert(err.message, "is-danger");
      }
    });

    function showAlert(message, type) {
      alertBox.innerHTML = `
        <div class="notification ${type} mt-3">
          <button class="delete" onclick="this.parentElement.remove()"></button>
          ${message}
        </div>
      `;
    }
  });
</script>
```

**Poin penting:**

- `credentials: 'include'` memastikan cookie session dikirim dan disimpan browser (bahkan jika frontend & backend beda port).
- Setelah login berhasil, `window.location.href` redirect user ke `dashboard.html`.

### Langkah 2: Setup CORS di backend (jika frontend & backend beda origin)

Kalau kamu buka `login.html` dari `file://` atau server statis di port lain (misal 8080), kamu butuh CORS. Install `cors`:

```bash
npm install cors
```

Edit `server.js`, tambahkan sebelum middleware session:

```js
const cors = require("cors");

// CORS - izinkan frontend dari origin tertentu
app.use(
  cors({
    origin: "http://localhost:8080", // Ganti dengan origin frontend kamu
    credentials: true, // Penting: izinkan cookie dikirim
  }),
);
```

Kalau frontend & backend sama origin (misal keduanya di port 3000), CORS tidak diperlukan.

### Langkah 3: Di `dashboard.html`, cek session & tampilkan username di navbar

Tambahkan script di `dashboard.html` untuk cek apakah user sudah login:

```html
<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item has-text-weight-bold" href="dashboard.html">
        BookPublisher
      </a>
      <!-- burger button -->
    </div>

    <div id="navbarMenu" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item">
          <span id="user-display" class="tag is-light">
            <span class="icon"><i class="fas fa-user"></i></span>
            <span id="username-text">Loading...</span>
          </span>
        </div>
        <div class="navbar-item">
          <button id="logout-btn" class="button is-small is-light">
            Logout
          </button>
        </div>
      </div>
    </div>
  </div>
</nav>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const usernameText = document.getElementById("username-text");
    const logoutBtn = document.getElementById("logout-btn");

    // Cek session dengan GET /api/me
    try {
      const response = await fetch("http://localhost:3000/api/me", {
        credentials: "include", // Kirim cookie session
      });

      if (!response.ok) {
        // Belum login -> redirect ke login page
        window.location.href = "login.html";
        return;
      }

      const userData = await response.json();
      usernameText.textContent = userData.username; // Tampilkan username
    } catch (err) {
      console.error(err);
      window.location.href = "login.html";
    }

    // Logout button
    logoutBtn.addEventListener("click", async () => {
      try {
        await fetch("http://localhost:3000/api/logout", {
          method: "POST",
          credentials: "include",
        });
        window.location.href = "login.html";
      } catch (err) {
        console.error(err);
        alert("Gagal logout");
      }
    });
  });
</script>
```

Pola ini mengikuti best practice:

- Saat halaman load, fetch `GET /api/me` untuk cek apakah user punya session aktif.
- Jika tidak (401), redirect ke login.
- Jika ya, tampilkan username di navbar.
- Tombol logout memanggil `POST /api/logout` lalu redirect ke login.

### Langkah 4: Protect semua halaman internal

Tambahkan script serupa di `inventory.html`, `add-book.html`, dll. supaya user yang belum login tidak bisa akses:

```html
<script>
  // Di awal DOMContentLoaded
  async function checkAuth() {
    try {
      const response = await fetch("http://localhost:3000/api/me", {
        credentials: "include",
      });
      if (!response.ok) {
        window.location.href = "login.html";
      }
    } catch (err) {
      window.location.href = "login.html";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    checkAuth();
    // ... script lainnya
  });
</script>
```

### Langkah 5: Update semua fetch API untuk sertakan credentials

Di semua fetch request ke backend (inventory, add book, update, delete), tambahkan `credentials: 'include'`:

```js
// Contoh di inventory.html
const response = await fetch("http://localhost:3000/api/books", {
  credentials: "include", // Tambahkan ini
});

// Contoh di add-book.html POST
const response = await fetch("http://localhost:3000/api/books", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  credentials: "include", // Tambahkan ini
  body: JSON.stringify(payload),
});
```

Tanpa `credentials: 'include'`, cookie session tidak dikirim dan request akan ditolak 401 Unauthorized oleh middleware `requireAuth`.

---

## Hasil Akhir

Setelah Sesi 28:

- ✅ Flow login benar-benar terintegrasi: `login.html` → API → session cookie → redirect dashboard.
- ✅ Dashboard menampilkan username user yang login di navbar.
- ✅ Tombol logout berfungsi dan membersihkan session.
- ✅ Halaman internal dilindungi: redirect otomatis ke login jika belum autentikasi.
- ✅ Semua API request membawa session cookie dengan `credentials: 'include'`.
