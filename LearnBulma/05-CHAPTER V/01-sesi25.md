---
title: Inline Edit Stock & Price
---

## Materi: Pengetahuan & Konsep

Di sesi ini kita lengkapi loop CRUD: **Update** data buku (stock & price) langsung dari tabel inventory, lalu kirim perubahan ke backend via `fetch()` dengan method `PUT`.

Pola umum untuk inline edit:

1. User mengubah nilai di input field (stock atau price).
2. User klik tombol "Save" atau "Update".
3. JavaScript ambil nilai baru, buat payload JSON, kirim `fetch()` dengan method `PUT` ke endpoint `PUT /api/books/:id`.
4. Backend memproses (di `server.js` kita sudah ada handler PUT), balas data buku yang sudah diupdate.
5. Frontend update tampilan tabel (atau tampilkan notifikasi sukses) tanpa reload seluruh halaman.

---

## Praktik: Tambahkan Inline Edit di `inventory.html`

Kita modifikasi tabel di `inventory.html` supaya kolom Stock dan Price bisa diedit langsung, lalu ada tombol "Save" per baris yang memanggil API PUT.

### 1. Ubah struktur tabel untuk input inline

Di fungsi `loadBooks()` (yang sudah kamu buat di Sesi 23), modifikasi bagian yang bikin `<tr>` supaya kolom Price dan Stock pakai `<input>` kecil:

```javascript
async function loadBooks() {
  const tbody = document.getElementById("books-table-body");
  if (!tbody) return;

  try {
    const response = await fetch("http://localhost:3000/api/books");
    if (!response.ok) {
      throw new Error("Gagal memuat data, status " + response.status);
    }
    const books = await response.json();

    tbody.innerHTML = "";

    books.forEach((book) => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <th>${book.id}</th>
        <td>
          <strong>${book.title}</strong><br>
          <small class="has-text-grey">${book.author}</small>
        </td>
        <td>${book.category || ""}</td>
        <td>${renderStatusTag(book.status)}</td>
        <td>
          <!-- Input Price inline -->
          <input 
            class="input is-small" 
            type="number" 
            id="price-${book.id}" 
            value="${book.price}" 
            style="width: 100px;"
          />
        </td>
        <td>
          <!-- Input Stock inline -->
          <input 
            class="input is-small" 
            type="number" 
            id="stock-${book.id}" 
            value="${book.stock}" 
            style="width: 80px;"
          />
        </td>
        <td class="has-text-right">
          <button 
            class="button is-small is-success" 
            onclick="updateBook(${book.id})"
          >
            <span class="icon is-small">
              <i class="fas fa-check"></i>
            </span>
          </button>
          <button 
            class="button is-small is-danger is-inverted" 
            onclick="deleteBook(${book.id})"
          >
            <span class="icon is-small">
              <i class="fas fa-trash"></i>
            </span>
          </button>
        </td>
      `;

      tbody.appendChild(tr);
    });
  } catch (err) {
    console.error(err);
    tbody.innerHTML = `
      <tr>
        <td colspan="7" class="has-text-centered has-text-danger">
          Gagal memuat data buku.
        </td>
      </tr>
    `;
  }
}

function renderStatusTag(status) {
  const s = (status || "").toUpperCase();
  let colorClass = "is-light";

  if (s === "PUBLISHED") colorClass = "is-success is-light";
  else if (s === "DRAFT") colorClass = "is-warning is-light";
  else if (s === "ARCHIVED") colorClass = "is-dark is-light";

  return `<span class="tag ${colorClass}">${s || "UNKNOWN"}</span>`;
}
```

**Perhatikan:**

- Kolom Price dan Stock sekarang pakai `<input class="input is-small">` dengan `id="price-{id}"` dan `id="stock-{id}"`, sehingga mudah diakses via JavaScript.
- Tombol hijau (checkmark) punya `onclick="updateBook(${book.id})"` untuk trigger update.

### 2. Tambahkan fungsi `updateBook()` dengan fetch PUT

**Tambahkan fungsi ini di script yang sama:**

```javascript
async function updateBook(id) {
  const priceInput = document.getElementById(`price-${id}`);
  const stockInput = document.getElementById(`stock-${id}`);

  if (!priceInput || !stockInput) {
    alert("Input tidak ditemukan.");
    return;
  }

  const newPrice = Number(priceInput.value) || 0;
  const newStock = Number(stockInput.value) || 0;

  const payload = {
    price: newPrice,
    stock: newStock,
  };

  try {
    const response = await fetch(`http://localhost:3000/api/books/${id}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(payload),
    }); // Pola PUT dengan fetch [web:182][web:184][web:187]

    if (!response.ok) {
      const errorData = await response.json().catch(() => null);
      const msg =
        errorData?.error || `Gagal update buku. Status: ${response.status}`;
      throw new Error(msg);
    }

    const updatedBook = await response.json();

    // Optional: tampilkan notifikasi singkat atau highlight baris
    alert(
      `Buku "${updatedBook.title}" berhasil diupdate!\nPrice: Rp${updatedBook.price}, Stock: ${updatedBook.stock}`,
    );

    // Optional: reload data untuk sinkronisasi tampilan
    // loadBooks();
  } catch (err) {
    console.error(err);
    alert("Terjadi kesalahan saat mengupdate buku.");
  }
}
```

Poin penting dari pola fetch PUT:

- Method: `PUT`.
- Headers: `Content-Type: application/json`.
- Body: `JSON.stringify(payload)`.
- Response handling: cek `response.ok`, parsing JSON untuk mendapat data buku hasil update.

### 3. (Opsional) Feedback visual yang lebih halus

Alih‑alih `alert()`, kamu bisa:

- Highlight baris tabel dengan class `has-background-success-light` selama 2 detik.
- Atau tampilkan notifikasi Bulma di atas tabel dengan fungsi `showAlert()` seperti di form.

Contoh highlight singkat:

```javascript
async function updateBook(id) {
  // ... (fetch code seperti di atas)

  if (response.ok) {
    const updatedBook = await response.json();

    // Highlight baris
    const row = document.getElementById(`stock-${id}`).closest("tr");
    row.classList.add("has-background-success-light");
    setTimeout(() => {
      row.classList.remove("has-background-success-light");
    }, 2000);
  }
}
```

Ini memberi feedback visual yang lebih smooth tanpa popup alert.

---

## Hasil Akhir

Setelah sesi ini:

- **CRUD lengkap** sudah tersambung antara UI Bulma dan backend Express:
  - **C**reate: form `add-book.html` → `POST /api/books` (Sesi 24).
  - **R**ead: tabel `inventory.html` → `GET /api/books` (Sesi 23).
  - **U**pdate: inline edit price/stock → `PUT /api/books/:id` (Sesi 25).
  - **D**elete: tombol trash → `DELETE /api/books/:id` (Sesi 23).

Frontend dan backend sudah benar‑benar terintegrasi dengan pattern REST API modern (fetch + JSON).
