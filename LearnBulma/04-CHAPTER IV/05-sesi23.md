---
title: Menghubungkan `inventory.html` ke REST API dengan `fetch()`
---

## Materi: Pengetahuan & Konsep

Di sesi ini kita sambungkan frontend Bulma (tabel inventori) ke backend Express yang sudah kamu buat, memakai **Fetch API** di browser untuk ambil data JSON dari `GET /api/books`.

Pola dasarnya:

- `fetch('http://localhost:3000/api/books')` → dapat `Response`.
- `response.json()` → parsing body ke JavaScript object/array.
- Loop array tersebut untuk membangun `<tr>` di `<tbody>` tabel.

---

## Praktik: Langkah demi Langkah

### 1. Sesuaikan HTML tabel di `inventory.html`

Tambahkan `id` ke `<tbody>` supaya mudah diisi lewat JS:

```html
<table class="table is-striped is-hoverable is-fullwidth">
  <thead>
    <tr>
      <th><abbr title="ID">ID</abbr></th>
      <th>Title</th>
      <th>Author</th>
      <th>Category</th>
      <th>Status</th>
      <th>Price</th>
      <th class="has-text-right">Actions</th>
    </tr>
  </thead>
  <tbody id="books-table-body">
    <!-- Awalnya kosong, akan diisi lewat JS -->
  </tbody>
</table>
```

### 2. Tambah script fetch di halaman (atau di `js/main.js`)

Untuk jelas, kita tulis dulu di bawah halaman `inventory.html` sebelum `</body>`:

```html
<script>
  async function loadBooks() {
    const tbody = document.getElementById("books-table-body");
    if (!tbody) return;

    try {
      const response = await fetch("http://localhost:3000/api/books");
      // pattern: fetch + response.json()
      if (!response.ok) {
        throw new Error("Gagal memuat data, status " + response.status);
      }
      const books = await response.json();

      // Kosongkan tbody dulu
      tbody.innerHTML = "";

      books.forEach((book) => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <th>${book.id}</th>
          <td>
            <a href="#" class="has-text-weight-bold">${book.title}</a>
          </td>
          <td>${book.author}</td>
          <td>${book.category || ""}</td>
          <td>
            ${renderStatusTag(book.status)}
          </td>
          <td>Rp ${book.price?.toLocaleString("id-ID") || 0}</td>
          <td class="has-text-right">
            <button class="button is-small is-info is-inverted">
              <span class="icon"><i class="fas fa-edit"></i></span>
            </button>
            <button
              class="button is-small is-danger is-inverted"
              onclick="deleteBook(${book.id})"
            >
              <span class="icon"><i class="fas fa-trash"></i></span>
            </button>
          </td>
        `;

        tbody.appendChild(tr);
      });
    } catch (err) {
      console.error(err);
      tbody.innerHTML = `
        <tr>
          <td colspan="7" class="has-text-centered has-text-danger">
            Gagal memuat data buku.
          </td>
        </tr>
      `;
    }
  }

  function renderStatusTag(status) {
    const s = (status || "").toUpperCase();
    let colorClass = "is-light";

    if (s === "PUBLISHED") colorClass = "is-success is-light";
    else if (s === "DRAFT") colorClass = "is-warning is-light";
    else if (s === "ARCHIVED") colorClass = "is-dark is-light";
    else if (s === "OUT_OF_STOCK") colorClass = "is-danger is-light";

    return `<span class="tag ${colorClass}">${s || "UNKNOWN"}</span>`;
  }

  async function deleteBook(id) {
    const confirmed = confirm("Yakin hapus buku ini?");
    if (!confirmed) return;

    try {
      const response = await fetch(`http://localhost:3000/api/books/${id}`, {
        method: "DELETE",
      });
      if (!response.ok && response.status !== 204) {
        throw new Error("Gagal menghapus, status " + response.status);
      }
      // Reload data setelah delete
      loadBooks();
    } catch (err) {
      console.error(err);
      alert("Terjadi kesalahan saat menghapus buku.");
    }
  }

  document.addEventListener("DOMContentLoaded", loadBooks);
</script>
```

Pola `fetch` ini mengikuti contoh resmi dan tutorial modern: panggil `fetch()`, cek `response.ok`, lalu panggil `response.json()` untuk parsing data.

### 3. Catatan CORS (kalau frontend & backend beda port)

Kalau kamu buka `inventory.html` via:

- `file://...` → bisa kena masalah CORS atau mixed origin.
- Server frontend (misal `http://localhost:8080`) dan backend `http://localhost:3000` → ini dua origin berbeda, browser akan menerapkan **CORS**.

Dalam latihan sederhana:

- Paling gampang: buka HTML lewat mini static server di **port yang sama** atau atur CORS di backend.
- Di Express, untuk latihan, kamu bisa pasang middleware `cors` (package `cors`) dan izinkan origin tertentu.

Tapi untuk tahap awal, kalau kamu buka `inventory.html` langsung dari Node/Express (nanti saat kita bahas static hosting) atau pakai setup sederhana yang sama origin, masalah CORS bisa dihindari.

---

**Dengan ini:**

- API Express kamu sudah benar‑benar dipakai oleh tabel Bulma.
- Setiap kali reload halaman, `fetch()` akan mengambil daftar buku terbaru dan render ke DOM.

Sesi berikutnya (Sesi 24), kalau kamu mau, kita bisa:

- Lanjut ke **form “Add Book”** (`add-book.html`) supaya submit‑nya benar‑benar mengirim `POST /api/books` dengan `fetch()` (bukan submit tradisional).
- Atau buat **quick edit** stock & price di `quick-edit.html` yang memanggil `PUT /api/books/:id` saat user mengubah nilai dan menekan tombol “Save”.
