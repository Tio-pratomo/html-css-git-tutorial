---
title: Form `Add Book`
---

## Materi: Pengetahuan & Konsep

Target sesi ini: form di `add-book.html` benar‑benar **mengirim data ke REST API Express** (`POST /api/books`) dengan **Fetch API**, bukan submit tradisional reload page.

Pola umum submit form pakai fetch:

1. Tangkap event `submit`, panggil `event.preventDefault()`.
2. Ambil nilai input dari form.
3. Buat object JavaScript, lalu `JSON.stringify()` ke `body`.
4. Panggil `fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body })`.
5. Cek `response.ok`, parse `response.json()`, lalu tampilkan notifikasi sukses/gagal.

---

## Praktik: Hubungkan `add-book.html` ke API

### 1. Pastikan form punya `id` dan `name`/`id` field jelas

Di `add-book.html`, bungkus input utama kira‑kira seperti ini (sesuaikan dengan form yang sudah kamu buat):

```html
<form id="add-book-form">
  <div class="field">
    <label class="label">Title</label>
    <div class="control">
      <input id="title" class="input" type="text" required />
    </div>
  </div>

  <div class="field">
    <label class="label">Author</label>
    <div class="control">
      <input id="author" class="input" type="text" required />
    </div>
  </div>

  <div class="field">
    <label class="label">Category</label>
    <div class="control">
      <input id="category" class="input" type="text" />
    </div>
  </div>

  <div class="field">
    <label class="label">Status</label>
    <div class="control">
      <div class="select">
        <select id="status">
          <option value="PUBLISHED">Published</option>
          <option value="DRAFT">Draft</option>
          <option value="ARCHIVED">Archived</option>
        </select>
      </div>
    </div>
  </div>

  <div class="field is-horizontal">
    <div class="field-body">
      <div class="field">
        <label class="label">Price</label>
        <div class="control">
          <input id="price" class="input" type="number" min="0" />
        </div>
      </div>
      <div class="field">
        <label class="label">Stock</label>
        <div class="control">
          <input id="stock" class="input" type="number" min="0" />
        </div>
      </div>
    </div>
  </div>

  <!-- File upload cover tetap seperti sebelumnya; di sesi ini kita fokus data JSON, bukan upload file binary -->

  <div class="field">
    <div class="control">
      <button type="submit" class="button is-primary">Save Book</button>
    </div>
  </div>

  <!-- Tempat notifikasi -->
  <div id="form-alert"></div>
</form>
```

`id` (`title`, `author`, dst.) akan dipakai JavaScript untuk baca value dan bentuk JSON.

### 2. Tambah script `fetch()` untuk submit form

Tambahkan di bawah halaman, sebelum `</body>` (boleh juga kamu pindah ke `js/main.js` nanti):

```html
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("add-book-form");
    const alertBox = document.getElementById("form-alert");

    if (!form) return;

    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      const title = document.getElementById("title").value.trim();
      const author = document.getElementById("author").value.trim();
      const category = document.getElementById("category").value.trim();
      const status = document.getElementById("status").value;
      const price = Number(document.getElementById("price").value) || 0;
      const stock = Number(document.getElementById("stock").value) || 0;

      if (!title || !author) {
        showAlert("Title dan Author wajib diisi.", "is-danger", alertBox);
        return;
      }

      const payload = {
        title,
        author,
        category,
        status,
        price,
        stock,
      };

      try {
        const response = await fetch("http://localhost:3000/api/books", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        }); // Pola POST JSON dengan fetch[web:166][web:173][web:174][web:180]

        if (!response.ok) {
          const errorData = await response.json().catch(() => null);
          const msg =
            errorData?.error || `Gagal menyimpan. Status: ${response.status}`;
          throw new Error(msg);
        }

        const created = await response.json();
        showAlert(
          `Buku "${created.title}" berhasil disimpan (ID: ${created.id}).`,
          "is-success",
          alertBox,
        );

        form.reset();
      } catch (err) {
        console.error(err);
        showAlert(
          "Terjadi kesalahan saat menyimpan buku.",
          "is-danger",
          alertBox,
        );
      }
    });
  });

  function showAlert(message, type, container) {
    if (!container) return;
    container.innerHTML = `
      <div class="notification ${type}">
        <button class="delete" onclick="this.parentElement.remove()"></button>
        ${message}
      </div>
    `;
  }
</script>
```

Poin penting:

- Kita gunakan `headers: { 'Content-Type': 'application/json' }` dan `body: JSON.stringify(payload)` untuk mengirim JSON, sesuai contoh‑contoh penggunaan Fetch untuk POST JSON.
- `response.ok` dicek; jika `false`, kita coba baca body JSON (error message dari server) sebelum melempar error.
- Setelah sukses, kita tampilkan notifikasi Bulma dan `form.reset()` untuk mengosongkan input.

---

Kalau ini sudah jalan:

- Flow `Add Book` kamu sekarang **end‑to‑end**: form Bulma → `fetch()` → Express API → array `books` backend.
- `inventory.html` yang sudah dihubungkan ke `GET /api/books` akan langsung menampilkan buku baru setelah reload halaman.

Sesi berikutnya (Sesi 25), kalau kamu mau, kita bisa:

- Membuat **quick edit** yang benar‑benar memanggil `PUT /api/books/:id` saat user mengubah stock/price di tabel, atau
- Membahas singkat **upload file cover** yang lebih “real” (multipart/form‑data ke backend), sebagai pengantar ke topik upload file di backend.
